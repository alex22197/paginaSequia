(function(){'use strict';var e;var k=function(a,b){a=parseInt(a.getAttribute("gwd-min-font-size-px"),10);isNaN(a)&&(a=b);return a},l=function(a,b){switch(a.getAttribute("gwd-fitting-truncate")){case "true":return!0;case "false":return!1;default:return b}};var p=function(a){var b=!1,c=null;return function(){b=!0;c||(b&&(a(),b=!1),c=setTimeout(function(){c=null;b&&(a(),b=!1)},100))}};var q=/[^\s\xA0]/,t=function(a){return(a=r.exec(a||""))?parseFloat(a[1]):null},r=/^(\d+|\d*\.\d+)px$/i,w=/^(\d+|\d*\.\d+)em$/i;function x(){this.a=[];this.s=10;this.w=!1}
x.prototype.fit=function(a){var b=[];a.forEach(function(a){if(this.a.every(function(b){return b.element!=a})&&!a.hasAttribute("gwd-dont-fit")){y(a);var c=z(this,a);this.a.push(c);b.push(c)}},this);b.forEach(function(a){var b={originalFontSize:a.h,fittedFontSizePx:a.A,wasTruncated:null!=a.i};null!=a.i&&(b.originalInnerHTML=a.i);a=a.element;if(b){var c=document.createEvent("CustomEvent");c.initCustomEvent("gwdtextfitted",!0,!0,b)}else c=document.createEvent("Event"),c.initEvent("gwdtextfitted",!0,!0);
a.dispatchEvent(c)})};
var A=function(a){a.a.forEach(function(a){a.element.style.fontSize=a.h});a.a=[]},B=function(a,b){b.forEach(function(a){for(var b=0;b<this.a.length;b++){var c=this.a[b];if(c.element==a){c.element.style.fontSize=c.h;this.a.splice(b,1);break}}}.bind(a))},z=function(a,b){var c=window.getComputedStyle(b),d=t(c.fontSize)||24,g=k(b,a.s),h=l(b,a.w);a=b.style.fontSize;c=null;a:{for(var u=b.clientWidth,f=b.clientHeight;d>=g;d--)if(b.style.fontSize=""+d+"px",!(b.scrollHeight>f||b.scrollWidth>u)){g=d;break a}if(h){c=
b.innerHTML;h=b.textContent;d=h.length;for(var m=1,v=0;10>v;v++){var n=Math.floor((d+m)/2);b.textContent=h.slice(0,n)+"\u2026";b.scrollHeight>f||b.scrollWidth>u?d=n:m=n}b.innerHTML=h.slice(0,m)+"\u2026"}}return{element:b,h:a,A:g,i:c}},y=function(a){function b(a,c){a.hasAttribute("gwd-dont-fit")||Array.prototype.forEach.call(a.children,function(a){var d=window.getComputedStyle(a).fontSize,f=t(d);if(f)f!=c&&(d=f/c,a.style.fontSize=d+"em");else if(d=(f=w.exec(d||""))?parseFloat(f[1]):null)f=d*c;else return;
b(a,f)})}var c=t(window.getComputedStyle(a).fontSize);null!=c&&b(a,c)};var C=function(a){this.v=a;this.g=new WeakMap;this.l=new WeakMap};C.prototype.saveInitialText=function(a){for(var b=document.createNodeIterator(a,NodeFilter.SHOW_TEXT,null,!1),c=null,d;d=b.nextNode();)if(q.test(d.textContent)){c=d;break}if(c&&(b=c.parentNode,b!=a)){a.setAttribute("gwd-dont-fit","");for(c=b;c.parentNode!=a;)c=c.parentNode;this.g.set(a,{f:c,parent:b})}};
C.prototype.applyStylePreservation=function(a){if(this.g.get(a)){a.ownerDocument.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_DISCONNECTED||D(this,a);var b=document.createElement("gwd-attached");a.appendChild(b);var c=function(){b.removeEventListener("attached",c);D(this,a);a.removeChild(b)}.bind(this);b.addEventListener("attached",c)}};
var D=function(a,b){var c=a.g.get(b),d=a.l.get(b)||{};if(c){c.f.style.display="none";b.insertBefore(c.f,b.firstChild);try{B(a.v,[b]);var g=getComputedStyle(c.parent);E.forEach(function(a){var c=g.getPropertyValue(a);!d.hasOwnProperty(a)&&c&&b.style.setProperty(a,c,"")});b.removeAttribute("gwd-dont-fit");a.v.fit([b])}finally{b.removeChild(c.f)}}};C.prototype.saveStyleOverride=function(a,b,c){var d=this.l.get(a)||{};d[b]=c;this.l.set(a,d)};var E="color font-family font-size font-style font-weight font-stretch text-align white-space".split(" ");var F=function(){};goog.inherits(F,HTMLElement);e=F.prototype;e.createdCallback=function(){this.b=new x;this.c=":not(*)";this.j=new C(this.b);this.F=this.D.bind(this);this.m=this.C.bind(this);document.addEventListener("pagetransitionstart",this.F);document.addEventListener("adinitialized",this.m);["fit-font-size-for-selector","gwd-fitting-truncate","gwd-min-font-size-px"].forEach(this.o,this);this.u=p(this.B.bind(this))};e.attachedCallback=function(){window.addEventListener("resize",this.u,!1)};
e.detachedCallback=function(){window.removeEventListener("resize",this.u,!1)};e.C=function(a){"gwd-doubleclick"==a.target.tagName.toLowerCase()&&(document.removeEventListener("adinitialized",this.m),this.fit(Array.prototype.slice.call(document.querySelectorAll(this.c))))};e.D=function(a){"gwd-pagedeck"==a.target.getAttribute("is").toLowerCase()&&this.fit(Array.prototype.slice.call(a.target.querySelectorAll(this.c)))};e.saveInitialText=function(a){this.j.saveInitialText(a)};
e.applyStylePreservation=function(a){this.j.applyStylePreservation(a)};e.saveStyleOverride=function(a,b,c){this.j.saveStyleOverride(a,b,c)};e.o=function(a){var b=this.getAttribute(a);switch(a){case "fit-font-size-for-selector":this.c=b||":not(*)";break;case "gwd-min-font-size-px":this.b.s=k(this,10);break;case "gwd-fitting-truncate":this.b.w=l(this,!1)}};e.fit=function(a){this.b.fit(a||Array.prototype.slice.call(document.querySelectorAll(this.c)))};e.attributeChangedCallback=function(a){this.o(a)};
e.B=function(){A(this.b);this.fit()};document.registerElement("gwd-text-helper",{prototype:F.prototype});}).call(this);
